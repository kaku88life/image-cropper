<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>圖片裁切工具</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>圖片裁切工具<img src="icons/icon48.png" alt="" class="title-icon"></h1>
            <button class="web-link-btn" id="openWebBtn" title="開啟網頁版完整功能">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                    <polyline points="15,3 21,3 21,9"/>
                    <line x1="10" y1="14" x2="21" y2="3"/>
                </svg>
                完整功能
            </button>
        </header>

        <main>
            <!-- 上傳區域 -->
            <div class="upload-area" id="uploadArea">
                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17,8 12,3 7,8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                <p>點擊、拖放或 Ctrl+V 貼上圖片</p>
                <input type="file" id="fileInput" accept="image/*" hidden>
            </div>

            <!-- 編輯區域 -->
            <div class="editor-area" id="editorArea">
                <!-- 頁籤切換 -->
                <div class="tab-header">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="edit" id="editTabBtn">裁切</button>
                        <button class="tab-btn" data-tab="result" id="resultTabBtn" disabled>結果</button>
                    </div>
                    <div class="tab-info">
                        <span>輸出: <strong id="outputSize">1280×800</strong></span>
                    </div>
                </div>

                <!-- 裁切頁籤 -->
                <div class="tab-content active" id="editTab">
                    <!-- 畫布容器 -->
                    <div class="canvas-container" id="canvasContainer">
                        <button class="remove-btn" id="removeImageBtn" title="移除圖片">×</button>
                        <div class="canvas-wrapper" id="canvasWrapper">
                            <canvas id="mainCanvas"></canvas>
                            <div class="crop-box" id="cropBox">
                                <div class="crop-handle nw" data-handle="nw"></div>
                                <div class="crop-handle n" data-handle="n"></div>
                                <div class="crop-handle ne" data-handle="ne"></div>
                                <div class="crop-handle w" data-handle="w"></div>
                                <div class="crop-handle e" data-handle="e"></div>
                                <div class="crop-handle sw" data-handle="sw"></div>
                                <div class="crop-handle s" data-handle="s"></div>
                                <div class="crop-handle se" data-handle="se"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 裁切設定 -->
                    <div class="crop-settings">
                        <div class="setting-row">
                            <label class="lock-ratio-label">
                                <input type="checkbox" id="lockRatio" checked>
                                <span>鎖定比例</span>
                            </label>
                            <div class="ratio-dropdown-wrapper">
                                <button class="ratio-dropdown-btn" id="ratioDropdownBtn">
                                    <span class="current-ratio" id="currentRatio">1280×800</span>
                                    <span class="dropdown-arrow">▼</span>
                                </button>
                                <div class="ratio-dropdown-menu" id="ratioDropdownMenu">
                                    <div class="ratio-option custom-ratio-option" data-ratio="custom">
                                        <span>自訂尺寸</span>
                                        <div class="custom-ratio-inputs">
                                            <input type="number" id="customWidth" placeholder="寬" min="1" value="1280">
                                            <span>×</span>
                                            <input type="number" id="customHeight" placeholder="高" min="1" value="800">
                                            <button class="apply-btn" id="applyCustomRatio">套用</button>
                                        </div>
                                    </div>
                                    <button class="ratio-option" data-ratio="free">自由裁切</button>
                                    <div class="ratio-divider"></div>
                                    <button class="ratio-option active" data-ratio="16:10">1280×800 (16:10)</button>
                                    <button class="ratio-option" data-ratio="16:9">1920×1080 (16:9)</button>
                                    <button class="ratio-option" data-ratio="4:3">1600×1200 (4:3)</button>
                                    <button class="ratio-option" data-ratio="1:1">1080×1080 (1:1)</button>
                                    <button class="ratio-option" data-ratio="3:2">1800×1200 (3:2)</button>
                                    <button class="ratio-option" data-ratio="2:3">1200×1800 (2:3)</button>
                                    <button class="ratio-option" data-ratio="9:16">1080×1920 (9:16)</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 動作按鈕 -->
                    <div class="action-row">
                        <button class="btn btn-secondary" id="resetBtn">重新選擇</button>
                        <button class="btn btn-primary" id="completeBtn">完成裁切</button>
                    </div>
                </div>

                <!-- 結果頁籤 -->
                <div class="tab-content" id="resultTab">
                    <div class="result-preview">
                        <button class="close-btn" id="resultCloseBtn" title="返回">×</button>
                        <img id="resultImage" src="" alt="處理結果" draggable="true">
                        <div class="drag-hint">拖曳圖片到其他應用程式</div>
                    </div>
                    <div class="result-actions">
                        <select id="formatSelect">
                            <option value="png">PNG</option>
                            <option value="jpeg">JPEG</option>
                            <option value="webp">WebP</option>
                        </select>
                        <button class="btn btn-primary" id="downloadBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7,10 12,15 17,10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            下載
                        </button>
                        <button class="btn btn-icon" id="copyBtn" title="複製">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2"/>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                            </svg>
                        </button>
                    </div>
                    <div class="result-tip">
                        需要編輯圖片？<a href="#" id="openWebLink">開啟網頁版</a>使用完整功能
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="popup.js"></script>
</body>
</html>
