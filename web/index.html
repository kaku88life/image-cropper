<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>圖片裁切工具 | Image Cropper</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><img src="icon.png" alt="" class="title-icon">圖片編輯工具</h1>
            <p class="subtitle">上傳圖片，裁切、調整、加工，輕鬆編輯</p>
        </header>

        <main>
            <section class="editor-section">
                <!-- 頁籤切換 -->
                <div class="tab-header" id="tabHeader">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="edit">編輯</button>
                        <button class="tab-btn" data-tab="result" id="resultTabBtn" disabled>結果</button>
                    </div>
                    <div class="tab-info" id="canvasInfo">
                        <span class="output-size">輸出: <strong id="cropSize">1280 × 800</strong></span>
                        <span class="info-divider">|</span>
                        <span class="preview-hint">預覽僅供參考，輸出畫質依原圖解析度</span>
                    </div>
                </div>

                <!-- 編輯頁籤內容 -->
                <div class="tab-content active" id="editTab">
                    <!-- 上傳區域 -->
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-content">
                            <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17,8 12,3 7,8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            <p>拖放圖片至此處</p>
                            <p class="upload-hint">或點擊選擇檔案，也可以 Ctrl+V 貼上</p>
                            <input type="file" id="fileInput" accept="image/*" hidden>
                        </div>
                    </div>

                    <!-- 畫布區域 -->
                    <div class="canvas-container" id="canvasContainer">
                        <!-- 右上角按鈕群組 -->
                        <div class="canvas-top-actions">
                            <button class="canvas-action-btn" id="downloadBtn" title="下載圖片">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7,10 12,15 17,10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                            </button>
                            <button class="canvas-action-btn" id="copyBtn" title="複製到剪貼簿">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                </svg>
                            </button>
                            <button class="canvas-action-btn remove-btn" id="removeImageBtn" title="移除圖片">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                        <div class="canvas-wrapper" id="canvasWrapper">
                            <canvas id="mainCanvas"></canvas>
                            <canvas id="drawCanvas"></canvas>
                            <!-- 選取框 -->
                            <div class="selection-box" id="selectionBox"></div>
                            <div class="crop-box" id="cropBox">
                                <div class="crop-handle nw" data-handle="nw"></div>
                                <div class="crop-handle n" data-handle="n"></div>
                                <div class="crop-handle ne" data-handle="ne"></div>
                                <div class="crop-handle w" data-handle="w"></div>
                                <div class="crop-handle e" data-handle="e"></div>
                                <div class="crop-handle sw" data-handle="sw"></div>
                                <div class="crop-handle s" data-handle="s"></div>
                                <div class="crop-handle se" data-handle="se"></div>
                            </div>
                            <div class="text-input-container" id="textInputContainer">
                                <textarea id="textInput" placeholder="輸入文字..."></textarea>
                                <div class="text-size-row">
                                    <label>大小:</label>
                                    <select id="textSizeSelect">
                                        <option value="16">小 (16)</option>
                                        <option value="24">中 (24)</option>
                                        <option value="36" selected>大 (36)</option>
                                        <option value="48">特大 (48)</option>
                                        <option value="72">超大 (72)</option>
                                    </select>
                                    <input type="number" id="textSizeInput" min="8" max="200" value="36" title="自訂大小">
                                </div>
                                <div class="text-input-actions">
                                    <button class="text-btn" id="textConfirm">確定</button>
                                    <button class="text-btn text-btn-cancel" id="textCancel">取消</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- 結果頁籤內容 -->
                <div class="tab-content" id="resultTab">
                    <div class="result-tip">
                        <p><strong>提示：</strong>如果拖曳到其他應用程式（如 LINE）無法正常顯示圖片：</p>
                        <ul>
                            <li>使用<strong>複製按鈕</strong>將圖片複製到剪貼簿，再按 Ctrl+V 貼上</li>
                            <li>或先<strong>下載圖片</strong>，再從電腦拖曳檔案傳送</li>
                        </ul>
                    </div>
                    <div class="result-preview">
                        <!-- 右上角按鈕群組 -->
                        <div class="result-top-actions">
                            <button class="canvas-action-btn" id="resultDownloadBtn" title="下載圖片">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7,10 12,15 17,10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                            </button>
                            <button class="canvas-action-btn" id="resultCopyBtn" title="複製到剪貼簿">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                </svg>
                            </button>
                            <button class="canvas-action-btn" id="resultShareBtn" title="分享">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="18" cy="5" r="3"/>
                                    <circle cx="6" cy="12" r="3"/>
                                    <circle cx="18" cy="19" r="3"/>
                                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                                </svg>
                            </button>
                            <button class="canvas-action-btn result-close-btn" id="resultCloseBtn" title="關閉結果">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                        <img id="resultImage" src="" alt="處理結果" draggable="true">
                        <div class="drag-hint">拖曳圖片到其他應用程式</div>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>Image Editor - 簡單易用的圖片編輯工具</p>
        </footer>
    </div>

    <!-- 浮動控制列容器 -->
    <div class="floating-container" id="floatingContainer">

        <!-- 調整工具列（最上層 - 調整模式時顯示） -->
        <div class="adjustment-toolbar" id="adjustmentToolbar">
            <!-- 色彩調整 -->
            <div class="floating-group adjust-sliders">
                <div class="adjust-slider-item">
                    <label title="亮度">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>
                    </label>
                    <input type="range" id="brightnessSlider" min="-100" max="100" value="0" title="亮度">
                    <span class="slider-value" id="brightnessValue">0</span>
                </div>
                <div class="adjust-slider-item">
                    <label title="對比度">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 2v20M12 2a10 10 0 0 1 0 20"/></svg>
                    </label>
                    <input type="range" id="contrastSlider" min="-100" max="100" value="0" title="對比度">
                    <span class="slider-value" id="contrastValue">0</span>
                </div>
                <div class="adjust-slider-item">
                    <label title="飽和度">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
                    </label>
                    <input type="range" id="saturationSlider" min="-100" max="100" value="0" title="飽和度">
                    <span class="slider-value" id="saturationValue">0</span>
                </div>
                <div class="adjust-slider-item">
                    <label title="色調">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                    </label>
                    <input type="range" id="hueSliderAdjust" min="-180" max="180" value="0" title="色調">
                    <span class="slider-value" id="hueValue">0</span>
                </div>
            </div>
            <div class="toolbar-divider"></div>
            <!-- 快速效果 -->
            <div class="floating-group quick-effects">
                <button class="tool-btn" id="autoAdjustBtn" title="自動調整">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
                </button>
                <button class="tool-btn" id="grayscaleBtn" title="灰階">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M12 3v18"/></svg>
                </button>
                <button class="tool-btn" id="negativeBtn" title="負片">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5" fill="currentColor"/><path d="M21 15l-5-5L5 21"/></svg>
                </button>
                <button class="tool-btn" id="resetAdjustBtn" title="重置調整">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                </button>
            </div>
        </div>

        <!-- 濾鏡工具列（調整模式時顯示） -->
        <div class="filter-toolbar" id="filterToolbar">
            <div class="floating-group filter-presets">
                <button class="filter-btn active" data-filter="none" title="原始">原始</button>
                <button class="filter-btn" data-filter="blackWhite" title="黑白">黑白</button>
                <button class="filter-btn" data-filter="sepia" title="棕褐色">棕褐</button>
                <button class="filter-btn" data-filter="sharpen" title="銳利化">銳利</button>
                <button class="filter-btn" data-filter="emboss" title="浮雕">浮雕</button>
                <button class="filter-btn" data-filter="vignette" title="暈影">暈影</button>
                <button class="filter-btn" data-filter="vintage" title="復古">復古</button>
            </div>
        </div>

        <!-- 繪圖工具列（中層） -->
        <div class="draw-toolbar" id="drawToolbar">
            <!-- 繪圖工具 -->
            <div class="floating-group draw-tools" id="drawTools">
                <!-- 筆刷下拉選單 -->
                <div class="tool-dropdown" id="penDropdown">
                    <button class="tool-dropdown-btn" id="penDropdownBtn" title="筆刷">
                        <span class="tool-icon" id="penIcon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M17 3a2.85 2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                            </svg>
                        </span>
                        <span class="dropdown-arrow">▾</span>
                    </button>
                    <div class="tool-dropdown-menu" id="penMenu">
                        <button class="tool-option" data-shape="pen" title="鉛筆">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 3a2.85 2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                            <span>鉛筆</span>
                        </button>
                        <button class="tool-option" data-shape="marker" title="簽字筆">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/></svg>
                            <span>簽字筆</span>
                        </button>
                        <button class="tool-option" data-shape="highlighter" title="螢光筆">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="m9 11-6 6v3h9l3-3"/><path d="m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4"/></svg>
                            <span>螢光筆</span>
                        </button>
                        <button class="tool-option" data-shape="eraser" title="橡皮擦">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"/><path d="M22 21H7"/></svg>
                            <span>橡皮擦</span>
                        </button>
                        <button class="tool-option" data-shape="mosaic" title="馬賽克筆刷">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                            <span>馬賽克</span>
                        </button>
                        <button class="tool-option" data-shape="blur" title="模糊筆刷">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="3"/><circle cx="12" cy="12" r="6" stroke-dasharray="2 2"/><circle cx="12" cy="12" r="9" stroke-dasharray="2 3"/></svg>
                            <span>模糊</span>
                        </button>
                    </div>
                </div>
                <!-- 形狀下拉選單 -->
                <div class="tool-dropdown" id="shapeDropdown">
                    <button class="tool-dropdown-btn" id="shapeDropdownBtn" title="形狀">
                        <span class="tool-icon" id="shapeIcon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                            </svg>
                        </span>
                        <span class="dropdown-arrow">▾</span>
                    </button>
                    <div class="tool-dropdown-menu" id="shapeMenu">
                        <button class="tool-option" data-shape="rect" title="矩形">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
                            <span>矩形</span>
                        </button>
                        <button class="tool-option" data-shape="circle" title="圓形">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="9"/></svg>
                            <span>圓形</span>
                        </button>
                        <button class="tool-option" data-shape="arrow" title="箭頭">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                            <span>箭頭</span>
                        </button>
                        <button class="tool-option" data-shape="line" title="直線">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 20 20 4"/></svg>
                            <span>直線</span>
                        </button>
                    </div>
                </div>
                <span class="toolbar-divider"></span>
                <button class="tool-btn" data-shape="text" title="文字">T</button>
                <button class="tool-btn" data-shape="fillBucket" id="fillBucketBtn" title="填色桶 (點擊區域填滿顏色)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <!-- 顏料桶 -->
                        <path d="M6 6h8v3c0 1-1 2-2 2H8c-1 0-2-1-2-2V6z"/>
                        <path d="M5 6c0-1 1-2 2-2h6c1 0 2 1 2 2"/>
                        <path d="M10 3v1"/>
                        <!-- 傾倒的顏料 -->
                        <path d="M14 11c2 1 4 3 5 6 1 2 0 3-1 3s-3-1-4-3c-1-1.5-1-3.5 0-6z" fill="currentColor" opacity="0.3"/>
                        <path d="M14 11c2 1 4 3 5 6 1 2 0 3-1 3s-3-1-4-3c-1-1.5-1-3.5 0-6z"/>
                    </svg>
                </button>
                <button class="tool-btn fill-toggle" id="fillToggleBtn" title="形狀填滿/空心切換 (僅影響矩形、圓形等形狀)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="3" y="3" width="18" height="18" rx="2" fill="currentColor" opacity="0.3"/>
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                    </svg>
                </button>
            </div>

            <div class="toolbar-divider"></div>


            <!-- 繪圖選項 -->
            <div class="floating-group draw-options" id="drawOptions">
                <!-- 顏色選擇器 -->
                <div class="color-picker-wrapper">
                    <button class="color-picker-btn" id="colorPickerBtn" title="顏色">
                        <span class="color-preview" id="colorPreview"></span>
                    </button>
                    <span class="color-code-display" id="colorCodeDisplay">#FF0000</span>
                    <div class="color-picker-popover" id="colorPickerPopover">
                        <div class="color-swatches">
                            <button class="color-swatch" data-color="#000000" style="background:#000000"></button>
                            <button class="color-swatch" data-color="#ffffff" style="background:#ffffff"></button>
                            <button class="color-swatch" data-color="#9ca3af" style="background:#9ca3af"></button>
                            <button class="color-swatch" data-color="#f87171" style="background:#f87171"></button>
                            <button class="color-swatch" data-color="#ef4444" style="background:#ef4444"></button>
                            <button class="color-swatch" data-color="#dc2626" style="background:#dc2626"></button>
                            <button class="color-swatch" data-color="#fb923c" style="background:#fb923c"></button>
                            <button class="color-swatch" data-color="#f97316" style="background:#f97316"></button>
                            <button class="color-swatch" data-color="#ea580c" style="background:#ea580c"></button>
                            <button class="color-swatch" data-color="#fbbf24" style="background:#fbbf24"></button>
                            <button class="color-swatch" data-color="#f59e0b" style="background:#f59e0b"></button>
                            <button class="color-swatch" data-color="#d97706" style="background:#d97706"></button>
                            <button class="color-swatch" data-color="#a3e635" style="background:#a3e635"></button>
                            <button class="color-swatch" data-color="#84cc16" style="background:#84cc16"></button>
                            <button class="color-swatch" data-color="#65a30d" style="background:#65a30d"></button>
                            <button class="color-swatch" data-color="#4ade80" style="background:#4ade80"></button>
                            <button class="color-swatch" data-color="#22c55e" style="background:#22c55e"></button>
                            <button class="color-swatch" data-color="#16a34a" style="background:#16a34a"></button>
                            <button class="color-swatch" data-color="#2dd4bf" style="background:#2dd4bf"></button>
                            <button class="color-swatch" data-color="#14b8a6" style="background:#14b8a6"></button>
                            <button class="color-swatch" data-color="#0d9488" style="background:#0d9488"></button>
                            <button class="color-swatch" data-color="#38bdf8" style="background:#38bdf8"></button>
                            <button class="color-swatch" data-color="#0ea5e9" style="background:#0ea5e9"></button>
                            <button class="color-swatch" data-color="#0284c7" style="background:#0284c7"></button>
                            <button class="color-swatch" data-color="#60a5fa" style="background:#60a5fa"></button>
                            <button class="color-swatch" data-color="#3b82f6" style="background:#3b82f6"></button>
                            <button class="color-swatch" data-color="#2563eb" style="background:#2563eb"></button>
                            <button class="color-swatch" data-color="#a78bfa" style="background:#a78bfa"></button>
                            <button class="color-swatch" data-color="#8b5cf6" style="background:#8b5cf6"></button>
                            <button class="color-swatch" data-color="#7c3aed" style="background:#7c3aed"></button>
                            <button class="color-swatch" data-color="#e879f9" style="background:#e879f9"></button>
                            <button class="color-swatch" data-color="#d946ef" style="background:#d946ef"></button>
                            <button class="color-swatch" data-color="#c026d3" style="background:#c026d3"></button>
                            <button class="color-swatch" data-color="#f472b6" style="background:#f472b6"></button>
                            <button class="color-swatch" data-color="#ec4899" style="background:#ec4899"></button>
                            <button class="color-swatch" data-color="#db2777" style="background:#db2777"></button>
                        </div>
                        <div class="hue-slider-wrapper">
                            <input type="range" id="hueSlider" class="hue-slider" min="0" max="360" value="0" title="色相">
                        </div>
                        <div class="color-custom">
                            <input type="color" id="colorPicker" value="#ff0000">
                            <input type="text" id="colorHexInput" value="#FF0000" maxlength="7" placeholder="#000000">
                            <button class="eyedropper-btn" id="eyedropperBtn" title="從圖片吸取顏色">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="m2 22 1-1h3l9-9"/>
                                    <path d="M3 21v-3l9-9"/>
                                    <path d="m15 6 3.4-3.4a2.1 2.1 0 1 1 3 3L18 9"/>
                                    <path d="m15 6 6 6-3 3"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- 粗細選擇器 -->
                <div class="stroke-width-wrapper">
                    <input type="range" id="strokeWidth" min="1" max="30" value="3" title="粗細">
                    <div class="stroke-preview" id="strokePreview">
                        <span class="stroke-dot"></span>
                    </div>
                </div>
            </div>

            <div class="toolbar-divider"></div>

            <!-- 繪圖操作 -->
            <div class="floating-group draw-actions" id="drawActions">
                <button class="tool-btn" id="undoBtn" title="上一步" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9,14 4,9 9,4"/>
                        <path d="M20 20v-7a4 4 0 0 0-4-4H4"/>
                    </svg>
                </button>
                <button class="tool-btn" id="redoBtn" title="下一步" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15,14 20,9 15,4"/>
                        <path d="M4 20v-7a4 4 0 0 1 4-4h12"/>
                    </svg>
                </button>
                <button class="tool-btn" id="clearDrawBtn" title="清除繪圖">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- 主浮動工具列（下層） -->
        <div class="floating-bar" id="floatingBar">
            <!-- 模式切換 -->
            <div class="floating-group mode-group">
                <button class="mode-btn active" data-tool="crop" title="裁切模式">裁切</button>
                <button class="mode-btn" data-tool="draw" title="繪圖模式">繪圖</button>
                <button class="mode-btn" data-tool="adjust" title="調整模式">調整</button>
            </div>

            <div class="floating-divider"></div>

            <!-- 變換工具 -->
            <div class="floating-group transform-group">
                <!-- 旋轉/翻轉下拉選單 -->
                <div class="tool-dropdown" id="rotateDropdown">
                    <button class="tool-dropdown-btn" id="rotateDropdownBtn" title="旋轉/翻轉">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12a9 9 0 1 1-9-9"/>
                            <polyline points="21 3 21 9 15 9"/>
                        </svg>
                        <span class="dropdown-arrow">▾</span>
                    </button>
                    <div class="tool-dropdown-menu" id="rotateMenu">
                        <button class="tool-option" data-rotate="90" title="順時針 90°">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 12a9 9 0 1 1-9-9"/><polyline points="21 3 21 9 15 9"/></svg>
                            <span>順時針 90°</span>
                        </button>
                        <button class="tool-option" data-rotate="-90" title="逆時針 90°">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 12a9 9 0 1 0 9-9"/><polyline points="3 3 3 9 9 9"/></svg>
                            <span>逆時針 90°</span>
                        </button>
                        <button class="tool-option" data-rotate="180" title="180°">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 2l4 4-4 4"/><path d="M3 11v-1a4 4 0 0 1 4-4h14"/><path d="M7 22l-4-4 4-4"/><path d="M21 13v1a4 4 0 0 1-4 4H3"/></svg>
                            <span>180°</span>
                        </button>
                        <div class="tool-option-divider"></div>
                        <button class="tool-option" id="flipHBtn" title="水平翻轉">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M8 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h3"/><path d="M16 3h3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-3"/><path d="M12 20v2"/><path d="M12 14v2"/><path d="M12 8v2"/><path d="M12 2v2"/></svg>
                            <span>水平翻轉</span>
                        </button>
                        <button class="tool-option" id="flipVBtn" title="垂直翻轉">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 8V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v3"/><path d="M21 16v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-3"/><path d="M4 12H2"/><path d="M10 12H8"/><path d="M16 12h-2"/><path d="M22 12h-2"/></svg>
                            <span>垂直翻轉</span>
                        </button>
                    </div>
                </div>
                <button class="tool-btn" id="resizeBtn" title="調整大小">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 3h6v6"/>
                        <path d="M9 21H3v-6"/>
                        <path d="M21 3l-7 7"/>
                        <path d="M3 21l7-7"/>
                    </svg>
                </button>
                <!-- 更多功能下拉選單 -->
                <div class="tool-dropdown" id="moreDropdown">
                    <button class="tool-dropdown-btn" id="moreDropdownBtn" title="更多功能">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="5" cy="12" r="1.5" fill="currentColor"/>
                            <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
                            <circle cx="19" cy="12" r="1.5" fill="currentColor"/>
                        </svg>
                        <span class="dropdown-arrow">▾</span>
                    </button>
                    <div class="tool-dropdown-menu" id="moreMenu">
                        <button class="tool-option" id="openUrlBtn" title="從 URL 開啟圖片">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                            <span>從 URL 開啟</span>
                        </button>
                        <button class="tool-option" id="printBtn" title="列印圖片">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
                            <span>列印</span>
                        </button>
                        <div class="tool-option-divider"></div>
                        <button class="tool-option" id="histogramBtn" title="顯示直方圖">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 3v18h18"/><path d="M7 16v-3"/><path d="M11 16v-8"/><path d="M15 16v-5"/><path d="M19 16v-2"/></svg>
                            <span>直方圖</span>
                        </button>
                        <button class="tool-option" id="watermarkBtn" title="新增浮水印">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>
                            <span>浮水印</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="floating-divider"></div>

            <!-- 輸出尺寸 -->
            <div class="floating-group">
                <label class="lock-ratio-label" title="鎖定比例">
                    <input type="checkbox" id="lockRatio" checked>
                    <span class="lock-text">鎖定</span>
                </label>
                <div class="ratio-dropdown-wrapper">
                    <button class="floating-dropdown-btn" id="ratioDropdownBtn">
                        <span class="dropdown-label">輸出尺寸</span>
                        <span class="dropdown-value" id="currentRatioText">1280×800</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="ratio-dropdown-menu" id="ratioDropdownMenu">
                        <div class="ratio-option custom-ratio-option" data-ratio="custom">
                            <span class="ratio-label">自訂尺寸</span>
                            <div class="custom-ratio-inputs">
                                <input type="number" id="customWidth" placeholder="寬" min="1" value="1280">
                                <span>×</span>
                                <input type="number" id="customHeight" placeholder="高" min="1" value="800">
                                <button class="apply-btn" id="applyCustomRatio">套用</button>
                            </div>
                        </div>
                        <button class="ratio-option" data-ratio="free">
                            <span class="ratio-label">自由裁切</span>
                            <span class="ratio-size">原始比例</span>
                        </button>
                        <div class="ratio-divider"></div>
                        <button class="ratio-option active" data-ratio="16:10">
                            <span class="ratio-label">1280×800</span>
                            <span class="ratio-size">16:10</span>
                        </button>
                        <button class="ratio-option" data-ratio="16:9">
                            <span class="ratio-label">1920×1080</span>
                            <span class="ratio-size">16:9</span>
                        </button>
                        <button class="ratio-option" data-ratio="4:3">
                            <span class="ratio-label">1600×1200</span>
                            <span class="ratio-size">4:3</span>
                        </button>
                        <button class="ratio-option" data-ratio="1:1">
                            <span class="ratio-label">1080×1080</span>
                            <span class="ratio-size">1:1</span>
                        </button>
                        <button class="ratio-option" data-ratio="3:2">
                            <span class="ratio-label">1800×1200</span>
                            <span class="ratio-size">3:2</span>
                        </button>
                        <button class="ratio-option" data-ratio="2:3">
                            <span class="ratio-label">1200×1800</span>
                            <span class="ratio-size">2:3</span>
                        </button>
                        <button class="ratio-option" data-ratio="9:16">
                            <span class="ratio-label">1080×1920</span>
                            <span class="ratio-size">9:16</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 輸出格式 -->
            <div class="floating-group">
                <div class="format-dropdown-wrapper">
                    <button class="floating-dropdown-btn" id="formatDropdownBtn">
                        <span class="dropdown-label">格式</span>
                        <span class="dropdown-value" id="currentFormatText">PNG</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="format-dropdown-menu" id="formatDropdownMenu">
                        <button class="format-option active" data-format="png" title="無損壓縮，支援透明背景">PNG</button>
                        <button class="format-option" data-format="jpeg" title="有損壓縮，檔案較小，不支援透明">JPEG</button>
                        <button class="format-option" data-format="webp" title="現代格式，壓縮效率高，支援透明">WebP</button>
                        <button class="format-option" data-format="avif" title="最新格式，最佳壓縮，部分瀏覽器支援">AVIF</button>
                        <button class="format-option" data-format="bmp" title="無壓縮，檔案較大">BMP</button>
                        <button class="format-option" data-format="svg" title="⚠️ 點陣圖嵌入 SVG 容器，非真正向量圖，放大仍會失真">SVG</button>
                    </div>
                </div>
            </div>

            <!-- 品質下拉選單 -->
            <div class="floating-group quality-control" id="qualityControl">
                <div class="quality-dropdown-wrapper">
                    <button class="floating-dropdown-btn" id="qualityDropdownBtn">
                        <span class="dropdown-label">品質</span>
                        <span class="dropdown-value" id="currentQualityText">90%</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="quality-dropdown-menu" id="qualityDropdownMenu">
                        <div class="quality-slider-container">
                            <input type="range" id="qualitySlider" min="10" max="100" value="90">
                            <span class="quality-value" id="qualityValue">90%</span>
                        </div>
                        <div class="quality-presets">
                            <button class="quality-preset" data-quality="100">最高 100%</button>
                            <button class="quality-preset active" data-quality="90">高 90%</button>
                            <button class="quality-preset" data-quality="80">中高 80%</button>
                            <button class="quality-preset" data-quality="60">中 60%</button>
                            <button class="quality-preset" data-quality="40">低 40%</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="floating-divider"></div>

            <!-- 重置按鈕 -->
            <button class="floating-btn reset-btn" id="resetAllBtn" title="重置所有設定">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12a9 9 0 1 1-9-9"/>
                    <polyline points="21 3 21 9 15 9"/>
                    <path d="M21 9l-5.66-5.66"/>
                </svg>
            </button>

            <!-- 完成按鈕 -->
            <button class="floating-btn complete-btn" id="completeBtn" disabled>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 6L9 17l-5-5"></path>
                </svg>
                完成
            </button>
        </div>
    </div>

    <!-- 對話框：從 URL 開啟 -->
    <div class="modal-overlay" id="urlModal">
        <div class="modal">
            <div class="modal-header">
                <h3>從 URL 開啟圖片</h3>
                <button class="modal-close" id="urlModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <input type="url" id="imageUrlInput" placeholder="https://example.com/image.jpg" class="modal-input">
                <p class="modal-hint">輸入圖片的完整網址</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="urlModalCancel">取消</button>
                <button class="modal-btn modal-btn-primary" id="urlModalConfirm">開啟</button>
            </div>
        </div>
    </div>

    <!-- 對話框：調整大小 -->
    <div class="modal-overlay" id="resizeModal">
        <div class="modal">
            <div class="modal-header">
                <h3>調整圖片大小</h3>
                <button class="modal-close" id="resizeModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="resize-inputs">
                    <div class="resize-input-group">
                        <label>寬度</label>
                        <input type="number" id="resizeWidth" min="1" max="10000" class="modal-input">
                        <span>px</span>
                    </div>
                    <div class="resize-input-group">
                        <label>高度</label>
                        <input type="number" id="resizeHeight" min="1" max="10000" class="modal-input">
                        <span>px</span>
                    </div>
                </div>
                <label class="resize-ratio-label">
                    <input type="checkbox" id="resizeMaintainRatio" checked>
                    維持比例
                </label>
                <p class="modal-hint">原始尺寸: <span id="originalSizeText">-</span></p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="resizeModalCancel">取消</button>
                <button class="modal-btn modal-btn-primary" id="resizeModalConfirm">套用</button>
            </div>
        </div>
    </div>

    <!-- 對話框：浮水印 -->
    <div class="modal-overlay" id="watermarkModal">
        <div class="modal modal-wide">
            <div class="modal-header">
                <h3>新增浮水印</h3>
                <button class="modal-close" id="watermarkModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="watermark-type-tabs">
                    <button class="watermark-tab active" data-type="text">文字浮水印</button>
                    <button class="watermark-tab" data-type="image">圖片浮水印</button>
                </div>
                <div class="watermark-content" id="watermarkTextContent">
                    <input type="text" id="watermarkText" placeholder="輸入浮水印文字..." class="modal-input">
                    <div class="watermark-options">
                        <div class="option-group">
                            <label>字型</label>
                            <select id="watermarkFontFamily" class="modal-select">
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="'Microsoft JhengHei', sans-serif" selected>微軟正黑體</option>
                                <option value="'PMingLiU', serif">新細明體</option>
                                <option value="'DFKai-SB', cursive">標楷體</option>
                                <option value="'Noto Sans TC', sans-serif">Noto Sans TC</option>
                                <option value="Georgia, serif">Georgia</option>
                                <option value="'Times New Roman', serif">Times New Roman</option>
                                <option value="'Courier New', monospace">Courier New</option>
                                <option value="Verdana, sans-serif">Verdana</option>
                                <option value="Impact, sans-serif">Impact</option>
                                <option value="'Comic Sans MS', cursive">Comic Sans MS</option>
                            </select>
                        </div>
                        <div class="option-group">
                            <label>字體大小</label>
                            <select id="watermarkFontSize" class="modal-select">
                                <option value="16">16px</option>
                                <option value="24" selected>24px</option>
                                <option value="36">36px</option>
                                <option value="48">48px</option>
                                <option value="72">72px</option>
                            </select>
                        </div>
                        <div class="option-group">
                            <label>顏色</label>
                            <input type="color" id="watermarkColor" value="#ffffff" class="modal-color">
                        </div>
                        <div class="option-group">
                            <label>透明度</label>
                            <input type="range" id="watermarkOpacity" min="10" max="100" value="50">
                            <span id="watermarkOpacityValue">50%</span>
                        </div>
                    </div>
                </div>
                <div class="watermark-content hidden" id="watermarkImageContent">
                    <div class="watermark-image-upload" id="watermarkImageUpload">
                        <input type="file" id="watermarkImageInput" accept="image/*" hidden>
                        <p>點擊選擇浮水印圖片</p>
                    </div>
                    <div class="watermark-options">
                        <div class="option-group">
                            <label>大小</label>
                            <input type="range" id="watermarkImageSize" min="10" max="100" value="30">
                            <span id="watermarkImageSizeValue">30%</span>
                        </div>
                        <div class="option-group">
                            <label>透明度</label>
                            <input type="range" id="watermarkImageOpacity" min="10" max="100" value="80">
                            <span id="watermarkImageOpacityValue">80%</span>
                        </div>
                    </div>
                </div>
                <div class="watermark-position">
                    <label>位置</label>
                    <div class="position-grid">
                        <button class="position-btn" data-position="top-left">↖</button>
                        <button class="position-btn" data-position="top-center">↑</button>
                        <button class="position-btn" data-position="top-right">↗</button>
                        <button class="position-btn" data-position="center-left">←</button>
                        <button class="position-btn" data-position="center">●</button>
                        <button class="position-btn" data-position="center-right">→</button>
                        <button class="position-btn" data-position="bottom-left">↙</button>
                        <button class="position-btn active" data-position="bottom-right">↘</button>
                        <button class="position-btn" data-position="bottom-center">↓</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="watermarkModalCancel">取消</button>
                <button class="modal-btn modal-btn-primary" id="watermarkModalConfirm">套用</button>
            </div>
        </div>
    </div>

    <!-- 側邊面板：直方圖 -->
    <div class="side-panel" id="histogramPanel">
        <div class="panel-header">
            <h3>直方圖</h3>
            <button class="panel-close" id="histogramPanelClose">&times;</button>
        </div>
        <div class="panel-content">
            <canvas id="histogramCanvas" width="256" height="150"></canvas>
            <div class="histogram-channels">
                <button class="channel-btn active" data-channel="rgb">RGB</button>
                <button class="channel-btn" data-channel="r">R</button>
                <button class="channel-btn" data-channel="g">G</button>
                <button class="channel-btn" data-channel="b">B</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
